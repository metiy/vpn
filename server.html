<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>VPN by metiy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Setup server</h1>
    </section>

    <section class="main-content">

	因为开发工作是在ubuntu下完成的,所以这里使用ubuntu来说明如何部署服务器.<br>

	<h3>已经测试过的系统</h3>
	<ul>
	<li>ubuntu 14.04</li>
	<li>ubuntu 12.04</li>
	</ul>


	<h3>需要的组件</h3>
	<ul>
	<li>python 2.7 (开发环境是 python 2.7 , 没测试过 python 3下是否正常)</li>
	<li>M2Crypto (md4加密)</li>
	<li>dnsmasq (提供DHCP服务，可选)</li>
	<li>screen (提供后台运行, 当然 nohup 或者其它的工具也可以 , 可选)</li>
	</ul>

	<h3>安装组件</h3>
	<ul><li><pre>sudo apt-get install python-m2crypto dnsmasq screen</pre></li></ul>

	<h3>配置系统</h3>
	<ul>
	<li>修改内核,让操作系统支持转发</li>
	修改 /etc/sysctrl.conf ,将ipv4的转发打开.<br>

	<pre>net.ipv4.ip_forward=1</pre>

	使用下面的指令,使配置生效<br>

	<pre>sudo sysctrl -p /etc/sysctrl.conf</pre>

	<li>配置NAT</li>
	使用下面的指令,为所有从eth0发出的数据,开启NAT模式.<br>

	<pre>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</pre>

	<li>配置dnsmasq </li>
	如果需要配置DHCP功能,请安装dnsmasq.<br>
	下面的示例中配置了<br>
	IP地址池为 192.168.7.10 - 192.168.7.150 , 掩码为255.255.255.0 , 分配时间为1小时.<br>
	网关配置为 192.168.7.1<br>
	DNS配置为 8.8.8.8<br>
<pre>
dhcp-range=192.168.7.10,192.168.7.150,255.255.255.0,1h
dhcp-option=option:router,192.168.7.1
dhcp-option=option:dns-server,8.8.8.8
</pre>
	配置完dnsmasq后,应该重启,配置才能生效.<br>
	<pre>sudo /etc/init.d/dnsmasq restart</pre>

	<li>配置服务器参数 </li>
	服务器的配置文件里面,大部分的参数都不需要修改.<br>
	但是强烈建议修改加密数据的密钥.比如改成下面的样子.
	<pre>key = "ifuhio8-euh8734763$^^&Y4KV" </pre>
	</ul>
	<h3>运行服务器</h3>
	服务需要管理员权限才能运行.
	<pre>sudo ./vpn-server.py</pre>
	如果希望服务在后台运行,请使用 nohup 或者 screen
	<pre>sudo nohup ./vpn-server.py > /dev/null & </pre>

    <footer class="site-footer">
    </footer>
    </section>

  </body>
</html>

